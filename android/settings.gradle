pluginManagement {
    repositories {
        google()
        mavenCentral()
        maven { url 'https://www.jitpack.io' }
    }
}

// Function to get the minor version of React Native
def getRNMinorVersion() {
    def version = providers.exec {
        commandLine("node", "-e", "console.log(require('react-native/package.json').version);")
    }.standardOutput.asText.get().trim()

    def coreVersion = version.split("-")[0]
    def (major, minor, patch) = coreVersion.tokenize('.').collect { it.toInteger() }

    return minor
}

// Configure React Native settings based on the version
if (getRNMinorVersion() >= 75) {
    extensions.configure(com.facebook.react.ReactSettingsExtension) { ex ->
        if (System.getenv('EXPO_UNSTABLE_CORE_AUTOLINKING') == '1') {
            println('\u001B[32mUsing expo-modules-autolinking as core autolinking source\u001B[0m')
            ex.autolinkLibrariesFromCommand([
                'node',
                '--no-warnings',
                '--eval',
                'require(require.resolve(\'expo-modules-autolinking\', { paths: [require.resolve(\'expo/package.json\')] }))(process.argv.slice(1))',
                'react-native-config',
                '--json',
                '--platform',
                'android'
            ].toList())
        } else {
            ex.autolinkLibrariesFromCommand()
        }
    }
}

rootProject.name = 'pharmacy'

dependencyResolutionManagement {
    versionCatalogs {
        create("reactAndroidLibs") {
            from(files("$rootDir/../gradle/libs.versions.toml")) // Ensure this path is correct
        }
    }
}

// Apply Expo modules autolinking
apply from: "$rootDir/../node_modules/expo/scripts/autolinking.gradle"
useExpoModules()

// Apply native modules settings for React Native versions below 75
if (getRNMinorVersion() < 75) {
    apply from: "$rootDir/../node_modules/@react-native-community/cli-platform-android/native_modules.gradle"
    applyNativeModulesSettingsGradle(settings)
}

// Include the app module and React Native Gradle plugin
include ':app'
includeBuild("$rootDir/../node_modules/@react-native/gradle-plugin")